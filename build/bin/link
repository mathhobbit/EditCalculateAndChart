#!/bin/sh
IOBLAKO_HOME=/Users/sergey_nikitin/EditCalculateAndChart
export IOBLAKO_HOME
#JAVA_HOME=`/usr/libexec/java_home`
JAVA_HOME=/usr/local/jvm/openjdk-17-internal
#JDK=jvm/openjdk-17-internal
JLINK=$JAVA_HOME/bin/jlink
JMOD=$JAVA_HOME/bin/jmod
ADDMYMODS=""
for file in `ls $IOBLAKO_HOME/build/jmods/*.jmod`
do
  mymod=`$JMOD describe $file|head -n 1`
if [ ! -z "$ADDMYMODS" ]; then
   ADDMYMODS=$ADDMYMODS","$mymod
else
    ADDMYMODS=$mymod
fi
done
echo $ADDMYMODS



if [ -d $IOBLAKO_HOME/build/EditCalculateAndChart ] 
then
rm -rf $IOBLAKO_HOME/build/EditCalculateAndChart
fi
#$JLINK --module-path $JAVA_HOME/jmods/ --module-path $IOBLAKO_HOME/build/jmods/ --add-modules $ADDMYMODS  --output $IOBLAKO_HOME/build/jre
$JLINK --module-path $JAVA_HOME/jmods:$IOBLAKO_HOME/build/jmods --add-modules $ADDMYMODS --launcher EditCalculateAndChart=org.ioblako.edit/org.ioblako.edit.EditCalculateAndChart --output $IOBLAKO_HOME/build/EditCalculateAndChart
